{% extends "base.html" %}
{% load static %}

{% block loading %}
<div id="loading">
    <img id="loading-image" src="{% static 'routes/thinker.gif' %}" alt="Loading..." />
</div>
{% endblock %}

{% block input %}
<p>Nice location!<br><br> Now enter the target time for you walk and let's get generating...
</p>
<h2>Input: Route Generation</h2>
<form action="/routegen/" method="POST"> {% csrf_token %}
    <label for="target_time">Target Time (mins):</label>
    <input 
        type="number" 
        id="target_time" 
        name="target_time" 
        min="0" 
        max="120" 
        step="1" 
        value="10"
        required>
    <br>
    <button id="abc" type="submit">Generate New Route</button>
</form>
<a href="/walk">Next: Start Walk</a>
{% endblock %}

{% block scriptSetTargetTime %}
<script>
    // persist form value from previous submission
    $("#target_time").val({{target_time}});

    // set custom validity
    // NOT WORKING FOR SOME REASON
    var t = document.getElementById("target_time");
    // document.getElementById("abc").innterHTML = t.value;

    var validityState_object = t.validity;
    if (validityState_object.valueMissing) {
        t.setCustomValidity("Yo, gotta fill this in.");
        t.reportValidity();
    }
    else if (validityState_object.rangeUnderflow) {
        t.setCustomValidity("Sorry, time travel is currently not supported. Please adhere to entropic time.");
        t.reportValidity();
    }
    else if (validityState_object.rangeOverflow) {
        t.setCustomValidity("Too high for our server. Please enter a lower value.");
        t.reportValidity();
    }
    else {
        t.setCustomValidity("");
        t.reportValidity();
    }
</script>
{% endblock %}

{% block map %}
    <p> SERVER:<br>
        The previous input had a target time of {{target_time}} minutes.<br>
        The resulting network (below) has {{number_of_nodes}} nodes.<br>
        The turnaround point candidate is at ({{rand_lat}}, {{rand_lon}}) degrees.
    </p>
    <div class="map">
        {{folium_map|safe}}
    </div>
{% endblock %}